<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <title>3 a.m. Lamp</title>
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="shortcut icon" href="images/favicon.ico">
    <link href="fonts/iconfont/iconfont.css" rel="stylesheet" type="text/css">
    <script src="//code.jquery.com/jquery-1.12.1.min.js"></script>
    <script src="//code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/ui-darkness/jquery-ui.css" />
    <script src="//cdn.jsdelivr.net/qtip2/3.0.3/jquery.qtip.min.js"></script>
    <link rel="stylesheet" href="//cdn.jsdelivr.net/qtip2/3.0.3/jquery.qtip.min.css" />
    <link href="//cdn.bootcss.com/semantic-ui/2.2.2/components/icon.css" rel="stylesheet">
    <link href="//cdn.bootcss.com/semantic-ui/2.2.2/components/grid.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="css/screen.css"/>
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400" />
    <link href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css">
</head>
<body>
<div id="danmuwindow">
  <form align="left">
    <textarea style="resize:none;width:100%;" name="danmu" id="danmucontent" rows=4 placeholder="#随手打点儿啥吧" required></textarea><br>
    <label for="user">用户ID</label><br>
    <input type="text" name="user" id="user" value="" style='width:100%' placeholder="#邮箱/用户名/昵称" required></input>
  </form>
</div>
<div class="main">
  <div class="logo-container">
  <div id="danmu"></div>
  </div>
  <div class="info-container">
      <div class="info-content">
      <img class="info-avatar" src="images/jugg.jpeg">
      <div class="info-link">
        <a id="danmuinput" class="info-icon extra"><i style="font-style:normal;">弹</i></a>
        <a class="info-icon extra" href="/babble"><i class="puzzle icon"></i></a>
        <a class="info-icon extra" href="/dubhe" target="_blank"><i class="marker icon"></i></a>
        <a class="info-icon" href="/bit"><i class="code icon"></i></a>
        <div style="width: 100px; height: 100px; float: left; margin: 0 20px;"></div>
        <a class="info-icon" href="/ent" target="_blank"><i class="film icon"></i></a>
        <a class="info-icon extra" href="http://blinkdagger.io:1990" target="_blank"><i class="iconfont python"></i></a>
        <a class="info-icon extra" href="http://blinkdagger.io:2009" target="_blank"><i class="iconfont Rlogo"></i></a>
        <a class="info-icon extra" href="http://blinkdagger.io:2013" target="_blank"><i class="iconfont mongodb"></i></a>
      </div>
      </div>
  </div>
  </div>
  <script type="text/javascript" src="js/jquery.danmu.js"></script>
  <script type="text/javascript">
    $("#danmu").danmu({
      height:'100%',
      width:'100%',
      left:0,
      top:5,
      right:0,
      danmuLoop:true,
      zindex :2,
      speed:10000
    });
    $("#danmuinput").qtip({ // Grab some elements to apply the tooltip to
      content: {
        text: '发条弹幕吧?'
      },
      position: {
        my: 'bottom center',
        at: 'top center'
      },
      style: {
        classes: 'qtip-blue qtip-shadow qtip-rounded'
      }
    });
    $(document).ready(function(){
      var Getdanmu = function() {
        $.ajax({
            method: "GET",
            dataType: 'jsonp',
            crossOrigin: true,
            async: false,
            jsonpCallback: 'callback',
            data: {"danmu_collection":"Blog","max_danmu_id":0},
            url:"https://blinkdagger.io/ent/danmu",
            success:function(data){
              console.log($('#danmu').data("nowTime"));
              var danmuss = data['danmuss'];
              for (var i = 0; i < danmuss.length; i++) {
                try {
                    var danmuLs = JSON.parse(danmuss[i]);
                } catch (e) {
                    continue;
                }
                $("#danmu").danmu("addDanmu",danmuLs);
              }
            }
        });
      };
      Getdanmu();
      $('#danmu').danmu('danmuStart');
      var refresh = function() {
        $('#danmu').data("nowTime",0);
      }
      var sync = setInterval(refresh, 15000);
      $(".info-avatar").click(
        function () {
            $('.logo-container').toggleClass("switch");
            $('#danmu').toggle();
            if($('#danmu').data("paused")){
                $('#danmu').danmu('danmuResume');
              }
            else{
                $('#danmu').danmu('danmuPause');
              }
          }
        );
      function Senddanmu(){
        if($.trim($('#user').val()) == '' | $.trim($('#danmucontent').val()) == ''){
              alert('Input Error! 格式空白或错误！');
           }
        else{
          var danmu = $.trim($('#danmucontent').val());
          var user = $.trim($('#user').val());
          var time = Math.floor(Math.random() * 110) + 1;
          var object = {"text":danmu,"color":"black","size":"1","position":"0","danmu_collection":"Blog","user":user,"time":time};
          $.ajax({
              method: "POST",
              dataType: 'json',
              crossOrigin: true,
              data: JSON.stringify(object),
              url:"https://blinkdagger.io/ent/danmu",
          });
          location.reload(true);
        }
      };
      $('#danmuwindow').dialog({
          autoOpen: false,
          title: '封面留言',
          height: 300,
          width: 350,
          modal: true,
          buttons: {
            "发送":Senddanmu
        },
      });
      $('#danmuinput').click(function() {
          $('#danmuwindow').dialog('open');
          return false;
      });
  });
  </script>
</body>
</html>
